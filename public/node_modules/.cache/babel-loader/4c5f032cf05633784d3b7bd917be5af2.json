{"ast":null,"code":"\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nvar dom_1 = require(\"./utils/dom\");\n\nvar date_1 = require(\"./utils/date\");\n\nvar locales_1 = require(\"./locales\"); // all realtime timer\n\n\nvar TIMER_POOL = {};\n/**\n * clear a timer from pool\n * @param tid\n */\n\nvar clear = function (tid) {\n  clearTimeout(tid);\n  delete TIMER_POOL[tid];\n}; // run with timer(setTimeout)\n\n\nfunction run(node, date, localeFunc, opts) {\n  // clear the node's exist timer\n  clear(dom_1.getTimerId(node));\n  var relativeDate = opts.relativeDate,\n      minInterval = opts.minInterval; // get diff seconds\n\n  var diff = date_1.diffSec(date, relativeDate); // render\n\n  node.innerText = date_1.formatDiff(diff, localeFunc);\n  var tid = setTimeout(function () {\n    run(node, date, localeFunc, opts);\n  }, Math.max(date_1.nextInterval(diff), minInterval || 1) * 1000, 0x7fffffff); // there is no need to save node in object. Just save the key\n\n  TIMER_POOL[tid] = 0;\n  dom_1.setTimerId(node, tid);\n} // 取消一个 node 的实时渲染\n\n\nfunction cancel(node) {\n  // cancel one\n  if (node) clear(dom_1.getTimerId(node)); // cancel all\n  // @ts-ignore\n  else Object.keys(TIMER_POOL).forEach(clear);\n}\n\nexports.cancel = cancel;\n/**\n * render a dom realtime\n * @param nodes\n * @param locale\n * @param opts\n */\n\nfunction render(nodes, locale, opts) {\n  // by .length\n  var nodeList = 'length' in nodes ? nodes : [nodes];\n  nodeList.forEach(function (node) {\n    run(node, dom_1.getDateAttribute(node), locales_1.getLocale(locale), opts || {});\n  });\n  return nodeList;\n}\n\nexports.render = render;","map":{"version":3,"mappings":";;;;;;AAAA;;AACA;;AACA,qC,CAGA;;;AACA,IAAMA,UAAU,GAAc,EAA9B;AAEA;;;;;AAIA,IAAMC,KAAK,GAAG,UAACC,GAAD,EAAY;AACxBC,cAAY,CAACD,GAAD,CAAZ;AACA,SAAOF,UAAU,CAACE,GAAD,CAAjB;AACD,CAHD,C,CAKA;;;AACA,SAASE,GAAT,CAAaC,IAAb,EAAgCC,IAAhC,EAA8CC,UAA9C,EAAsEC,IAAtE,EAAgF;AAC9E;AACAP,OAAK,CAACQ,iBAAWJ,IAAX,CAAD,CAAL;AAEQ;AAAA,MAAcK,8BAAd,CAJsE,CAM9E;;AACA,MAAMC,IAAI,GAAGC,eAAQN,IAAR,EAAcO,YAAd,CAAb,CAP8E,CAQ9E;;AACAR,MAAI,CAACS,SAAL,GAAiBF,kBAAWD,IAAX,EAAiBJ,UAAjB,CAAjB;AAEA,MAAML,GAAG,GAAIa,UAAU,CACrB;AACEX,OAAG,CAACC,IAAD,EAAOC,IAAP,EAAaC,UAAb,EAAyBC,IAAzB,CAAH;AACD,GAHoB,EAIrBQ,IAAI,CAACC,GAAL,CAASL,oBAAaD,IAAb,CAAT,EAA6BD,WAAW,IAAI,CAA5C,IAAiD,IAJ5B,EAKrB,UALqB,CAAvB,CAX8E,CAmB9E;;AACAV,YAAU,CAACE,GAAD,CAAV,GAAkB,CAAlB;AACAO,mBAAWJ,IAAX,EAAiBH,GAAjB;AACD,C,CAED;;;AACA,SAAgBgB,MAAhB,CAAuBb,IAAvB,EAAyC;AACvC;AACA,MAAIA,IAAJ,EAAUJ,KAAK,CAACQ,iBAAWJ,IAAX,CAAD,CAAL,CAAV,CACA;AACA;AAFA,OAGKc,MAAM,CAACC,IAAP,CAAYpB,UAAZ,EAAwBqB,OAAxB,CAAgCpB,KAAhC;AACN;;AANDqB;AAQA;;;;;;;AAMA,SAAgBC,MAAhB,CAAuBC,KAAvB,EAAsDC,MAAtD,EAAuEjB,IAAvE,EAAkF;AAChF;AACA,MAAMkB,QAAQ,GAAa,YAAYF,KAAZ,GAAoBA,KAApB,GAA8B,CAACA,KAAD,CAAzD;AAEAE,UAAQ,CAACL,OAAT,CAAiB,UAAChB,IAAD,EAAkB;AACjCD,OAAG,CAACC,IAAD,EAAOI,uBAAiBJ,IAAjB,CAAP,EAA+BsB,oBAAUF,MAAV,CAA/B,EAAkDjB,IAAI,IAAI,EAA1D,CAAH;AACD,GAFD;AAIA,SAAOkB,QAAP;AACD;;AATDJ","names":["TIMER_POOL","clear","tid","clearTimeout","run","node","date","localeFunc","opts","dom_1","minInterval","diff","date_1","relativeDate","innerText","setTimeout","Math","max","cancel","Object","keys","forEach","exports","render","nodes","locale","nodeList","locales_1"],"sources":["realtime.ts"],"sourcesContent":[null]},"metadata":{},"sourceType":"script"}